/*!
 * MCropper.js v1.1.0
 * https://dgmpk.github.io/mcropper/
 *
 * Copyright 2018-present dgmpk
 * Released under the MIT license
 *
 * Date: 2019-01-26T06:56:01.796Z
 */
!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("alloyfinger")):"function"==typeof define&&define.amd?define(["alloyfinger"],t):i.MCropper=t(i.AlloyFinger)}(this,function(i){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var c="$$mcropper",t=function i(t,e,o){var r=this;t[c]&&t[c].destroy(),(t[c]=this).container=t,this.options=g({},i.defaults,o);var h=this.options,n=h.width,s=h.height,a=h.aspectRatio;(n||s)&&(n&&(this.cropBoxWidth=n),s&&(this.cropBoxHeight=s),this.cropBoxHeight||(this.cropBoxHeight=this.cropBoxWidth/a),this.cropBoxWidth||(this.cropBoxWidth=this.cropBoxHeight*a)),this.canvas=document.createElement("canvas"),g(this.canvas.style,{position:"absolute",zIndex:"1",top:"0",left:"0"}),this.ctx=this.canvas.getContext("2d"),this.drawCropBox=this.options.circle?function(i){return r.ctx.arc(r.container.clientWidth/2,r.container.clientHeight/2,r.cropBoxWidth/2+i/2,0,2*Math.PI,!1)}:function(i){return r.ctx.rect(r.container.clientWidth/2-r.cropBoxWidth/2-i/2,r.container.clientHeight/2-r.cropBoxHeight/2-i/2,r.cropBoxWidth+i,r.cropBoxHeight+i)},this.callbacks=[],this.options.onReady&&this.callbacks.push(this.options.onReady),this.img=new Image,"http"===e.substring(0,4).toLowerCase()&&(this.img.crossOrigin="anonymous"),this.img.onload=this.init.bind(this),this.img.src=e};function n(i,t){var e=t[0],o=t[1];return i<e?e:o<i?o:i}function g(e){for(var i=[],t=arguments.length-1;0<t--;)i[t]=arguments[t+1];return i.forEach(function(i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])}),e}return t.prototype.init=function(){var i;for(this.container.appendChild(this.canvas),this.initData(),this.renderCenter(),this.addFingerListener(),this.options.responsive&&(this.resizeListener=this.resize.bind(this),window.addEventListener("resize",this.resizeListener)),this.ready=!0;i=this.callbacks.shift();)i(this)},t.prototype.initData=function(){var i=this.canvas.width=this.container.clientWidth,t=this.canvas.height=this.container.clientHeight,e=this.options,o=e.width,r=e.height,h=e.aspectRatio,n=e.containRatio;o||r||(i/t<h?(this.cropBoxWidth=i*n,this.cropBoxHeight=this.cropBoxWidth/h):(this.cropBoxHeight=t*n,this.cropBoxWidth=this.cropBoxHeight*h)),this.imgOriginX=(i-this.cropBoxWidth)/2,this.imgOriginY=(t-this.cropBoxHeight)/2,this.imgMinScale=Math.max(this.cropBoxWidth/this.img.naturalWidth,this.cropBoxHeight/this.img.naturalHeight)},t.prototype.renderCenter=function(){var i=this.imgMinScale;this.render(this.imgOriginX-(this.img.naturalWidth*i-this.cropBoxWidth)/2,this.imgOriginY-(this.img.naturalHeight*i-this.cropBoxHeight)/2,i)},t.prototype.render=function(i,t,e){this.renderCover(),this.renderImage(i,t,e)},t.prototype.renderCover=function(){var i=this.ctx,t=this.options,e=t.modalOpacity,o=t.borderColor,r=t.borderWidth,h=t.borderOrigin;i.save(),i.globalCompositeOperation="copy",i.globalAlpha=e,i.fillStyle="black",i.fillRect(0,0,this.container.clientWidth,this.container.clientHeight),i.restore();var n="out"===h?r:"in"===h?-r:0;i.save(),i.beginPath(),i.globalCompositeOperation="destination-out",this.drawCropBox(n+r),i.fill(),i.restore(),i.save(),i.beginPath(),i.strokeStyle=o,i.lineWidth=r,this.drawCropBox(n),i.stroke(),i.restore()},t.prototype.renderImage=function(i,t,e){if((e=Math.max(e,this.imgMinScale))!==this.imgScale){this.imgScale=e,this.imgWidth=this.img.naturalWidth*e,this.imgHeight=this.img.naturalHeight*e;var o=this.imgWidth-this.cropBoxWidth,r=this.imgHeight-this.cropBoxHeight;this.imgXRange=[this.imgOriginX-o,this.imgOriginX],this.imgYRange=[this.imgOriginY-r,this.imgOriginY]}this.imgX=n(i,this.imgXRange),this.imgY=n(t,this.imgYRange);var h=this.ctx;h.save(),h.globalCompositeOperation="destination-over",h.drawImage(this.img,this.imgX,this.imgY,this.imgWidth,this.imgHeight),h.restore()},t.prototype.zoomImage=function(i,t,e){var o=t[0],r=t[1],h=e[0],n=e[1],s=(i=Math.max(this.imgMinScale,i))/this.imgScale;o*=s,r*=s,this.render(h-o,n-r,i)},t.prototype.addFingerListener=function(){var a=this,e=0,o=[0,0],r=function(i){var t=i.touches,e=t[0],o=t[1],r=(e.pageX+o.pageX)/2,h=(e.pageY+o.pageY)/2,n=a.container.getBoundingClientRect(),s=n.top;return[r-n.left,h-s]},h=function(i){var t=i[0],e=i[1];o=[t-a.imgX,e-a.imgY]};this.alloyFinger=new i(this.canvas,{multipointStart:function(i){e=a.imgScale,h(r(i))},pinch:function(i){var t=r(i);a.zoomImage(e*i.zoom,o,t),h(t)},pressMove:function(i){i.preventDefault(),a.render(a.imgX+i.deltaX,a.imgY+i.deltaY,a.imgScale)}})},t.prototype.resize=function(){if(this.options.restore){var i=this.getImageData(),t=i[0],e=i[1],o=this.imgScale/this.imgMinScale;this.initData();var r=this.imgMinScale*o;this.render(this.imgOriginX-t*r,this.imgOriginY-e*r,r)}else this.initData(),this.renderCenter()},t.prototype.getImageData=function(){var i=this.imgScale;return[(this.imgOriginX-this.imgX)/i,(this.imgOriginY-this.imgY)/i,this.cropBoxWidth/i,this.cropBoxHeight/i]},t.prototype.crop=function(i){if(!this.ready)throw new Error("can't crop before ready");i=i||1;var t=document.createElement("canvas"),e=t.getContext("2d"),o=this.cropBoxWidth/this.cropBoxHeight,r=this.getImageData();if(i.width)t.width=i.width,t.height=i.width*o;else if(i.height)t.height=i.height,t.width=i.width/o;else if(i.naturalRatio)t.width=r[2]*i.naturalRatio,t.height=r[3]*i.naturalRatio;else{var h=i.outputRatio||Number(i);t.width=this.cropBoxWidth*h,t.height=this.cropBoxHeight*h}return e.drawImage(this.img,r[0],r[1],r[2],r[3],0,0,t.width,t.height),t},t.prototype.onReady=function(i){!0===this.ready?i(this):this.callbacks.push(i)},t.prototype.destroy=function(){this.callbacks=[],this.alloyFinger.destroy(),window.removeEventListener("resize",this.resizeListener),this.container.removeChild(this.canvas),this.container.$$mcropper=null},t.defaults={containRatio:.92,aspectRatio:1,modalOpacity:.6,borderColor:"rgba(51, 153, 255, 0.75)",borderWidth:1,borderOrigin:"out",responsive:!0,restore:!0},t});