/*!
 * MCropper.js v1.0.0
 * undefined
 *
 * Copyright 2018-present dgmpk
 * Released under the MIT license
 *
 * Date: 2018-09-29T15:22:13.876Z
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("alloyfinger")):"function"==typeof define&&define.amd?define(["alloyfinger"],i):t.MCropper=i(t.AlloyFinger)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var o="$$mcropper",r={containRatio:.92,aspectRatio:1,modalOpacity:.6,borderColor:"rgba(51, 153, 255, 0.75)",borderWidth:1,responsive:!0,restore:!0},i=function(t,i,e){var h=this;if(t[o]&&t[o].destroy(),(t[o]=this).container=t,this.containerWidth=t.clientWidth,this.containerHeight=t.clientHeight,this.options=e=n({},r,e),e.width||e.height)e.width&&(this.cropBoxWidth=e.width),e.height&&(this.cropBoxHeight=e.height);else{if(1<e.containRatio)throw new Error("options.containRatio must be less than or equal to 1");e.aspectRatio>t.clientWidth/t.clientHeight?this.cropBoxWidth=t.clientWidth*e.containRatio:this.cropBoxHeight=t.clientHeight*e.containRatio}if(this.cropBoxHeight||(this.cropBoxHeight=this.cropBoxWidth/e.aspectRatio),this.cropBoxWidth||(this.cropBoxWidth=this.cropBoxHeight*e.aspectRatio),this.cropBoxWidth!==this.cropBoxHeight&&e.circle)throw new Error("can't set options.circle to true when width is not equal to height");this.imgOriginX=(this.containerWidth-this.cropBoxWidth)/2,this.imgOriginY=(this.containerHeight-this.cropBoxHeight)/2,this.canvas=document.createElement("canvas"),n(this.canvas.style,{position:"absolute",zIndex:"1",top:"0px",left:"0px"}),this.canvas.width=this.containerWidth,this.canvas.height=this.containerHeight,this.ctx=this.canvas.getContext("2d"),this.callbacks=[],e.onReady&&this.callbacks.push(e.onReady),this.img=new Image,"http"===i.substring(0,4).toLowerCase()&&(this.img.crossOrigin="anonymous"),this.img.onload=function(){return h.init()},this.img.src=i};function a(t,i){var e=i[0],h=i[1];return t<e?e:h<t?h:t}function n(e){for(var t=[],i=arguments.length-1;0<i--;)t[i]=arguments[i+1];return t.forEach(function(t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}),e}return i.prototype.init=function(){var t;for(this.container.appendChild(this.canvas),this.imgWidth=this.img.naturalWidth,this.imgHeight=this.img.naturalHeight,this.imgOriginScale=Math.max(this.cropBoxWidth/this.imgWidth,this.cropBoxHeight/this.imgHeight),this.renderCenter(),this.addFingerListener(),this.options.responsive&&(this.resizeListener=this.resize.bind(this),window.addEventListener("resize",this.resizeListener)),this.ready=!0;t=this.callbacks.shift();)t(this)},i.prototype.renderCenter=function(){this.render((this.imgWidth*this.imgOriginScale-this.cropBoxWidth)/2,(this.imgHeight*this.imgOriginScale-this.cropBoxHeight)/2,this.imgOriginScale)},i.prototype.render=function(t,i,e){this.clearCavnvas(),this.renderCover(),this.renderCropBox(),this.renderImage(t,i,e)},i.prototype.clearCavnvas=function(){var t=this.ctx;t.save(),t.globalCompositeOperation="copy",t.globalAlpha=0,t.fillRect(0,0,this.containerWidth,this.containerHeight),t.restore()},i.prototype.renderImage=function(t,i,e){if((e=Math.max(e,this.imgOriginScale))!==this.imgScale){var h=this,o=h.cropBoxWidth,r=h.cropBoxHeight,n=h.imgWidth,s=h.imgHeight;this.imgScale=e,this.imgMaxOffsetX=n*e-o,this.imgMaxOffsetY=s*e-r}this.imgStartX=a(t,[0,this.imgMaxOffsetX]),this.imgStartY=a(i,[0,this.imgMaxOffsetY]),this.ctx.save(),this.ctx.globalCompositeOperation="destination-over",this.ctx.drawImage(this.img,this.imgOriginX-this.imgStartX,this.imgOriginY-this.imgStartY,this.imgWidth*e,this.imgHeight*e),this.ctx.restore()},i.prototype.renderCover=function(){var t=this.ctx;t.save(),t.fillStyle="black",t.globalAlpha=this.options.modalOpacity,t.fillRect(0,0,this.containerWidth,this.containerHeight),t.restore()},i.prototype.renderCropBox=function(){var t=this,i=t.ctx,e=t.cropBoxWidth,h=t.cropBoxHeight,o=t.containerWidth,r=t.containerHeight,n=this.options.circle?function(t){return i.arc(o/2,r/2,e/2+t/2,0,2*Math.PI,!1)}:function(t){return i.rect(o/2-e/2-t/2,r/2-h/2-t/2,e+t,h+t)};i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),n(0),i.fill(),i.restore(),i.save(),i.beginPath(),i.strokeStyle=this.options.borderColor,i.lineWidth=this.options.borderWidth,n(i.lineWidth),i.stroke(),i.restore()},i.prototype.zoomImage=function(t,i,e,h,o){var r=(t=Math.max(this.imgOriginScale,t))/this.imgScale;i*=r,e*=r;var n=this.imgOriginX-(h-i),s=this.imgOriginY-(o-e);this.render(n,s,t)},i.prototype.addFingerListener=function(){var l=this,m=0,u=null,f=null;this.alloyFinger=new t(this.canvas,{multipointStart:function(t){var i,e,h,o,r,n,s,a=t.touches,c=a[0],g=a[1],p=(c.pageX+g.pageX)/2,d=(c.pageY+g.pageY)/2;e=l.container,h=p,o=d,r=e.getBoundingClientRect(),n=r.top,s=r.left,u=(i=[h-s,o-n])[0],f=i[1],m=l.imgScale},pinch:function(t){var i=u-(l.imgOriginX-l.imgStartX),e=f-(l.imgOriginY-l.imgStartY);l.zoomImage(m*t.zoom,i,e,u,f)},pressMove:function(t){t.preventDefault(),l.render(l.imgStartX-t.deltaX,l.imgStartY-t.deltaY,l.imgScale)}})},i.prototype.resetSize=function(){this.containerWidth=this.canvas.width=this.container.clientWidth,this.containerHeight=this.canvas.height=this.container.clientHeight;var t=this.options,i=t.width,e=t.height,h=t.aspectRatio,o=t.containRatio;i||e||(h>this.containerWidth/this.containerHeight?(this.cropBoxWidth=this.containerWidth*o,this.cropBoxHeight=this.cropBoxWidth/h):(this.cropBoxHeight=this.containerHeight*o,this.cropBoxWidth=this.cropBoxHeight*h)),this.imgOriginX=(this.containerWidth-this.cropBoxWidth)/2,this.imgOriginY=(this.containerHeight-this.cropBoxHeight)/2,this.imgOriginScale=Math.max(this.cropBoxWidth/this.imgWidth,this.cropBoxHeight/this.imgHeight)},i.prototype.resize=function(){if(this.options.restore){var t=this.getImageData(),i=t[0],e=t[1],h=this.imgScale/this.imgOriginScale;this.resetSize();var o=this.imgOriginScale*h;this.render(i*o,e*o,o)}else this.resetSize(),this.renderCenter()},i.prototype.getImageData=function(){var t=this.imgScale;return[this.imgStartX/t,this.imgStartY/t,this.cropBoxWidth/t,this.cropBoxHeight/t]},i.prototype.crop=function(t){if(!this.ready)throw new Error("can't crop before ready");t=t||1;var i=document.createElement("canvas"),e=i.getContext("2d"),h=this.cropBoxWidth/this.cropBoxHeight,o=this.getImageData();if(t.width)i.width=t.width,i.height=t.width*h;else if(t.height)i.height=t.height,i.width=t.width/h;else if(t.naturalRatio)i.width=o[2]*t.naturalRatio,i.height=o[3]*t.naturalRatio;else{var r=t.outputRatio||Number(t);i.width=this.cropBoxWidth*r,i.height=this.cropBoxHeight*r}return e.drawImage(this.img,o[0],o[1],o[2],o[3],0,0,i.width,i.height),i},i.prototype.onReady=function(t){!0===this.ready?t(this):this.callbacks.push(t)},i.prototype.destroy=function(){this.callbacks=[],this.alloyFinger.destroy(),window.removeEventListener("resize",this.resizeListener),this.container.removeChild(this.canvas),this.container.$$mcropper=null},i});