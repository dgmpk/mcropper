/*!
 * MCropper.js v2.0.0
 * https://dgmpk.github.io/mcropper/
 *
 * Copyright 2018-present dgmpk
 * Released under the MIT license
 *
 * Date: 2019-08-02T14:10:21.279Z
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("alloyfinger")):"function"==typeof define&&define.amd?define(["alloyfinger"],i):t.MCropper=i(t.AlloyFinger)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;function c(t,i,e,o){var r=this;t[g]&&t[g].destroy(),(t[g]=this).container=t,"object"==typeof i?(e=i,i=null):"function"==typeof e&&(o=e,e=null),this.options=p({},c.defaults,e);var n=this.options,h=n.width,a=n.height,s=n.aspectRatio;(h||a)&&(h&&(this.cropBoxWidth=h),a&&(this.cropBoxHeight=a),this.cropBoxHeight||(this.cropBoxHeight=this.cropBoxWidth/s),this.cropBoxWidth||(this.cropBoxWidth=this.cropBoxHeight*s)),this.canvas=document.createElement("canvas"),p(this.canvas.style,{position:"absolute",zIndex:"1",top:"0",left:"0"}),this.ctx=this.canvas.getContext("2d"),this.drawCropBox=this.options.circle?function(t){return r.ctx.arc(r.container.clientWidth/2,r.container.clientHeight/2,r.cropBoxWidth/2+t/2,0,2*Math.PI,!1)}:function(t){return r.ctx.rect(r.container.clientWidth/2-r.cropBoxWidth/2-t/2,r.container.clientHeight/2-r.cropBoxHeight/2-t/2,r.cropBoxWidth+t,r.cropBoxHeight+t)},this.container.appendChild(this.canvas),this.img=new Image,i&&this.setSrc(i,o)}var g="__MCropper__";function h(t,i){var e=i[0],o=i[1];return t<e?e:o<t?o:t}function p(e){for(var t=[],i=arguments.length-1;0<i--;)t[i]=arguments[i+1];return t.forEach(function(t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}),e}return c.prototype.setSrc=function(t,i){this.alloyFingerListener&&this.alloyFingerListener.destroy(),this.ready=!1,this.src=t,this.callbackfns=[],i&&this.callbackfns.push(i),"http"===t.substring(0,4).toLowerCase()&&(this.img.crossOrigin="anonymous"),this.img.onload=this.init.bind(this),this.img.src=t},c.prototype.init=function(){var t;for(this.ready=!0,this.calculateImgData(),this.renderCenter();t=this.callbackfns.shift();)t(this);this.addFingerListener()},c.prototype.calculateImgData=function(){var t=this.canvas.width=this.container.clientWidth,i=this.canvas.height=this.container.clientHeight,e=this.options,o=e.width,r=e.height,n=e.aspectRatio,h=e.containRatio;o||r||(t/i<n?(this.cropBoxWidth=t*h,this.cropBoxHeight=this.cropBoxWidth/n):(this.cropBoxHeight=i*h,this.cropBoxWidth=this.cropBoxHeight*n)),this.cropBoxOriginX=(t-this.cropBoxWidth)/2,this.cropBoxOriginY=(i-this.cropBoxHeight)/2,this.imgMinScale=Math.max(this.cropBoxWidth/this.img.naturalWidth,this.cropBoxHeight/this.img.naturalHeight)},c.prototype.renderCenter=function(){var t=this.imgMinScale;this.render(this.cropBoxOriginX-(this.img.naturalWidth*t-this.cropBoxWidth)/2,this.cropBoxOriginY-(this.img.naturalHeight*t-this.cropBoxHeight)/2,t)},c.prototype.render=function(t,i,e){this.renderCover(),this.renderImage(t,i,e)},c.prototype.renderCover=function(){var t=this.ctx,i=this.options,e=i.modalOpacity,o=i.borderColor,r=i.borderWidth,n=i.borderOrigin;t.save(),t.globalCompositeOperation="copy",t.globalAlpha=e,t.fillStyle="black",t.fillRect(0,0,this.container.clientWidth,this.container.clientHeight),t.restore();var h="out"===n?r:"in"===n?-r:0;t.save(),t.beginPath(),t.globalCompositeOperation="destination-out",this.drawCropBox(h+r),t.fill(),t.restore(),t.save(),t.beginPath(),t.strokeStyle=o,t.lineWidth=r,this.drawCropBox(h),t.stroke(),t.restore()},c.prototype.renderImage=function(t,i,e){if((e=Math.max(e,this.imgMinScale))!==this.imgScale){this.imgScale=e,this.imgWidth=this.img.naturalWidth*e,this.imgHeight=this.img.naturalHeight*e;var o=this.imgWidth-this.cropBoxWidth,r=this.imgHeight-this.cropBoxHeight;this.imgOriginXRange=[this.cropBoxOriginX-o,this.cropBoxOriginX],this.imgOriginYRange=[this.cropBoxOriginY-r,this.cropBoxOriginY]}this.imgOriginX=h(t,this.imgOriginXRange),this.imgOriginY=h(i,this.imgOriginYRange);var n=this.ctx;n.save(),n.globalCompositeOperation="destination-over",n.drawImage(this.img,this.imgOriginX,this.imgOriginY,this.imgWidth,this.imgHeight),n.restore()},c.prototype.zoomImage=function(t,i,e){var o=i[0],r=i[1],n=e[0],h=e[1],a=(t=Math.max(this.imgMinScale,t))/this.imgScale;this.render(n-o*a,h-r*a,t)},c.prototype.pagePointToContainerPoint=function(t){var i=t[0],e=t[1],o=this.container.getBoundingClientRect(),r=o.top;return[i-o.left,e-r]},c.prototype.containerPointToImagePoint=function(t){var i=t[0],e=t[1];return[i-this.imgOriginX,e-this.imgOriginY]},c.prototype.addFingerListener=function(){function e(t){var i,e=[].slice.apply(t.touches).map(function(t){return[t.pageX,t.pageY]});return i=1===e.length?e[0]:2===e.length?[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]:function(t){for(var i=t.length,e=0,o=0,r=0,n=1;n<=i;n++){var h=t[n%i],a=h[0],s=h[1],c=t[n-1],g=c[0],p=c[1],l=(a*p-s*g)/2;e+=l,o+=l*(a+g)/3,r+=l*(s+p)/3}return[o/=e,r/=e]}(e),h.pagePointToContainerPoint(i)}function o(t){n=h.containerPointToImagePoint(t)}var r,n,h=this;this.alloyFingerListener=new t(this.canvas,{multipointStart:function(t){r=h.imgScale,o(e(t))},pinch:function(t){var i=e(t);h.zoomImage(r*t.zoom,n,i),o(i)},pressMove:function(t){t.preventDefault(),h.render(h.imgOriginX+t.deltaX,h.imgOriginY+t.deltaY,h.imgScale)}})},c.prototype.resize=function(t){if(t)this.calculateImgData(),this.renderCenter();else{var i=this.getImageData(),e=i[0],o=i[1],r=this.imgScale/this.imgMinScale;this.calculateImgData();var n=this.imgMinScale*r;this.render(this.cropBoxOriginX-e*n,this.cropBoxOriginY-o*n,n)}},c.prototype.getImageData=function(){var t=this.imgScale;return[(this.cropBoxOriginX-this.imgOriginX)/t,(this.cropBoxOriginY-this.imgOriginY)/t,this.cropBoxWidth/t,this.cropBoxHeight/t]},c.prototype.crop=function(t,i){if(void 0===t&&(t=1),void 0===i&&(i="ratio"),!this.ready)throw new Error("can't crop before ready");var e=document.createElement("canvas"),o=e.getContext("2d"),r=this.cropBoxWidth/this.cropBoxHeight,n=this.getImageData();switch(i){case"width":e.width=t,e.height=t*r;break;case"height":e.height=t,e.width=t/r;break;case"naturalRatio":e.width=n[2]*t,e.height=n[3]*t;break;default:e.width=this.cropBoxWidth*t,e.height=this.cropBoxHeight*t}return o.drawImage(this.img,n[0],n[1],n[2],n[3],0,0,e.width,e.height),e},c.prototype.onReady=function(t){!0===this.ready?t(this):this.callbackfns.push(t)},c.prototype.destroy=function(){this.img.src=this.img.onload=null,this.alloyFingerListener&&this.alloyFingerListener.destroy(),this.container.removeChild(this.canvas),delete this.container[g]},c.defaults={aspectRatio:1,containRatio:.92,modalOpacity:.6,borderColor:"rgba(51, 153, 255, 0.75)",borderWidth:1,borderOrigin:"out"},c});